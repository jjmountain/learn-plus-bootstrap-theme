export function decode(s) {
  return s.replace(/(%[0-9A-Z]{2})+/g, decodeURIComponent)
}

export function getCookie(key, json, req = document) {
  if (typeof req === 'undefined') {
    return
  }

  var jar = {}
  // To prevent the for loop in the first place assign an empty array
  // in case there are no cookies at all.
  var cookies = req.cookie ? req.cookie.split('; ') : []
  var i = 0

  for (; i < cookies.length; i++) {
    var parts = cookies[i].split('=')
    var cookie = parts.slice(1).join('=')

    if (!json && cookie.charAt(0) === '"') {
      cookie = cookie.slice(1, -1)
    }

    try {
      var name = decode(parts[0])
      cookie = decode(cookie)

      if (json) {
        try {
          cookie = JSON.parse(cookie)
        } catch (e) {}
      }

      jar[name] = cookie

      if (key === name) {
        break
      }
    } catch (e) {}
  }

  return key ? jar[key] : jar
}
