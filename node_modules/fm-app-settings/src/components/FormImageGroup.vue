<template>
  <div
    :class="groupClasses"
    :aria-required="required"
    :aria-invalid="computedAriaInvalid"
    class="row no-gutters flex-nowrap form-image-group"
    role="radiogroup"
    tabindex="-1">
    <div
      v-for="(item, idx) in options"
      :key="`${name}-${ item.value }`"
      :class="{ 'ml-2': idx > 0 }"
      class="col">
      <b-form-radio 
        :id="`${name}-${ item.value }`"
        :value="item.value"
        :disabled="item.disabled"
        :required="Boolean(name && required)"
        :name="name">
        <b-img
          :src="item.image" 
          :alt="item.text" 
          fluid />
      </b-form-radio>
    </div>
  </div>
</template>

<style lang="scss">
@import 'ui-learnplus-bootstrap/scss/variables.scss';

.form-image-group {
  position: relative;
  .form-check {
    margin: 0;
  }
  .form-check-inline .form-check-input {
    position: absolute;
    z-index: -1; // Put the input behind the label so it doesn't overlay text
    opacity: 0;
  }
  label {
    cursor: pointer;
    margin: 0;
    padding: 4px;
    border: 1px solid $border-color;
    border-radius: $border-radius;
  }
  :checked ~ label {
    padding: 2px;
    border: 3px solid $primary;
  }
  .is-valid & {
    :checked ~ label {
      border-color: $success;
    }
  }
  .is-invalid & {
    label {
      border-color: $danger;
    }
  }
}
</style>

<script>
import idMixin from 'bootstrap-vue/es/mixins/id'
import formOptionsMixin from 'bootstrap-vue/es/mixins/form-options'
import formMixin from 'bootstrap-vue/es/mixins/form'

export default {
  mixins: [idMixin, formMixin, formOptionsMixin],
  model: {
    prop: 'checked',
    event: 'input'
  },
  props: {
    checked: {
      type: [String, Object, Number, Boolean],
      default: null
    },
    validated: {
      // Used for applying the `was-validated` class to the group
      type: Boolean,
      default: false
    },
    ariaInvalid: {
      type: [Boolean, String],
      default: false
    }
  },
  data() {
    return {
      localChecked: this.checked,
      // Flag for children
      is_RadioCheckGroup: true,
      plain: true
    }
  },
  computed: {
    groupClasses() {
      return [this.validated ? 'was-validated' : '']
    },
    computedAriaInvalid() {
      if (
        this.ariaInvalid === true ||
        this.ariaInvalid === 'true' ||
        this.ariaInvalid === ''
      ) {
        return 'true'
      }
      return this.get_State === false ? 'true' : null
    },
    get_State() {
      // Required by child radios
      return this.computedState
    }
  },
  watch: {
    checked(newVal, oldVal) {
      this.localChecked = this.checked
    },
    localChecked(newVal, oldVal) {
      this.$emit('input', newVal)
    }
  }
}
</script>
