<template>
  <div
    :is="$props.tagname" 
    class="ps-container" 
    @mouseover.once="update" 
    @ps-scroll-y="scrollHandle" 
    @ps-scroll-x="scrollHandle" 
    @ps-scroll-up="scrollHandle" 
    @ps-scroll-down="scrollHandle" 
    @ps-scroll-left="scrollHandle" 
    @ps-scroll-right="scrollHandle" 
    @ps-y-reach-start="scrollHandle" 
    @ps-y-reach-end="scrollHandle" 
    @ps-x-reach-start="scrollHandle" 
    @ps-x-reach-end="scrollHandle">
    <slot />
  </div>
</template>

<style lang="scss">
@import '~perfect-scrollbar/css/perfect-scrollbar.css';
.ps-container {
  position: relative;
}
</style>

<script>
import PerfectScrollbar from 'perfect-scrollbar'

export default {
  props: {
    settings: {
      type: Object,
      default() {
        return {
          wheelPropagation: false
        }
      }
    },
    tagname: {
      type: String,
      default: 'div'
    }
  },
  data() {
    return {
      ps: null
    }
  },
  watch: {
    $route() {
      this.update()
    }
  },
  mounted() {
    if (!this.$isServer) {
      this.__init()
    }
  },
  updated() {
    this.$nextTick(this.update)
  },
  activated() {
    this.__init()
  },
  deactivated() {
    this.__uninit()
  },
  beforeDestroy() {
    this.__uninit()
  },
  methods: {
    scrollHandle(evt) {
      this.$emit(evt.type, evt)
    },
    update() {
      this.ps.update()
    },
    __init() {
      if (!this.ps) {
        this.ps = new PerfectScrollbar(this.$el, this.settings)
      } else {
        this.update()
      }
    },
    __uninit() {
      this.ps.destroy()
      this.ps = null
    }
  }
}
</script>
