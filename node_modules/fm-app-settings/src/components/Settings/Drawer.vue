<template>
  <drawer 
    id="settings" 
    :align="localAlign">
    <sidebar 
      :align="localAlign"
      :type="sidebarType"
      :variant="localSidebarVariant">
      <div class="p-2">

        <collapse
          v-for="option in options"
          :key="`collapse-${option.id}`"
          :id="option.id"
          :title="option.title">
          
          <b-form-group
            v-for="(group, index) in option.children"
            :key="`group-${option.id}-${index}`"
            :label="group.title"
            :class="{ 'mb-0': index === option.children.length - 1 }">

            <form-image-group
              v-if="group.component === 'form-image-group'"
              :options="group.options"
              v-model="settings[`${option.id}.${group.id}`]"
              :name="group.id" />

            <b-form-radio-group 
              v-if="group.component === 'b-form-radio-group'"
              :id="`group-${option.id}-${index}`"
              v-model="settings[`${option.id}.${group.id}`]"
              :options="group.options" />

            <b-form-checkbox
              v-if="group.component === 'b-form-checkbox'"
              :id="`group-${option.id}-${index}`"
              v-model="settings[`${option.id}.${group.id}`]">
              {{ group.title }}
            </b-form-checkbox>

            <b-form-checkbox
              v-if="group.component === 'custom-checkbox-toggle'"
              :id="`group-${option.id}-${index}`"
              v-model="settings[`${option.id}.${group.id}`]"
              class="custom-checkbox-toggle custom-control-inline mr-1">&nbsp;</b-form-checkbox>

            <label 
              v-if="group.component === 'custom-checkbox-toggle'"
              :for="`group-${option.id}-${index}`"
              class="mb-0">
              <span class="form-label m-0">{{ group.title }}</span>
            </label>

          </b-form-group>
        </collapse>

        <slot />

        <pre 
          v-if="debug" 
          v-text="settings" />

      </div>
    </sidebar>
  </drawer>
</template>

<style lang="scss">
@import 'ui-learnplus-bootstrap/scss/variables.scss';

#settings {
  .mdk-drawer__content {
    width: 300px;
  }
  .mdk-drawer__scrim {
    background-color: rgba($body-color, 0.5);
  }
  .col-form-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    color: $text-muted;
    line-height: 1rem;
    font-weight: 500;
  }
}
</style>

<script>
import Settings from '~/components/Settings/Settings'
import Drawer from '~/components/Layout/Drawer'
import Sidebar from '~/components/Layout/Sidebar'
import { drawerProps } from '~/components/Layout/Drawer.props'
import { sidebarProps } from '~/components/Layout/Sidebar.props'
import { prefixProps } from '~/utils/props'

export default {
  components: {
    Drawer,
    Sidebar
  },
  extends: Settings,
  props: {
    ...prefixProps(drawerProps, 'drawer'),
    ...prefixProps(sidebarProps, 'sidebar')
  },
  computed: {
    localAlign() {
      if (this.mainDrawerAlign) {
        return this.mainDrawerAlign === 'end' ? 'left' : 'right'
      }
      return this.drawerAlign
    },
    localSidebarVariant() {
      return this.sidebarVariant || 'sidebar-transparent-xs-up'
    }
  }
}
</script>
